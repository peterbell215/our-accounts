<%# Wrap both forms in a container if needed for layout %>
<div class="pure-g"> <%# Example using PureCSS grid %>

  <%# Main Definition Form - Takes up part of the width %>
  <div class="pure-u-1 pure-u-md-2-3">
    <%= form_with(model: import_columns_definition, html: { class: "pure-form pure-form-aligned" }) do |form| %>
      <% if import_columns_definition.errors.any? %>
        <div id="error_explanation" class="pure-alert pure-alert-error">
          <h2><%= pluralize(import_columns_definition.errors.count, "error") %> prohibited this import columns definition from being saved:</h2>
          <ul>
            <% import_columns_definition.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <fieldset>
        <legend>Import Definition</legend>
        <div class="pure-control-group">
          <%= form.label :account_id %>
          <%= form.select :account_id, options_from_collection_for_select(Account.all, :id, :name, import_columns_definition.account_id), {} %>
        </div>

        <div class="pure-control-group">
          <%= form.label :header %>
          <%= form.check_box :header %>
          <span class="pure-form-message-inline">Does the CSV file have a header row?</span>
        </div>

        <div class="pure-control-group">
          <%= form.label :reversed %>
          <%= form.check_box :reversed %>
          <span class="pure-form-message-inline">Are transactions listed newest first?</span>
        </div>

        <div class="pure-control-group">
          <%= form.label :credit_sign %>
          <div class="credit-sign-container">
            <%= form.radio_button :credit_sign, 1, id: "credit_sign_positive" %>
            <%= form.label :credit_sign_positive, "+ (Positive)", for: "credit_sign_positive", class: "pure-radio" %>
            <%= form.radio_button :credit_sign, -1, id: "credit_sign_negative" %>
            <%= form.label :credit_sign_negative, "- (Negative)", for: "credit_sign_negative", class: "pure-radio" %>
            <span class="pure-form-message-inline">Sign of credit amounts?</span>
          </div>
        </div>

        <legend>Column Mapping</legend>
        <p>Enter the column name (if header row exists) or the 0-based column index number.</p>

        <% column_fields = [
          :date_column, :date_format, :trx_type_column, :sortcode_column,
          :account_number_column, :other_party_column, :amount_column,
          :debit_column, :credit_column, :balance_column
        ] %>

        <% column_fields.each do |field| %>
          <div class="pure-control-group">
            <%= form.label field %>
            <% if field == :date_format %>
              <%= form.text_field field, placeholder: "e.g., %d/%m/%Y or %Y-%m-%d" %>
              <span class="pure-form-message-inline"><a href="https://ruby-doc.org/stdlib-3.1.2/libdoc/date/rdoc/Date.html#method-c-strptime-label-Format+Codes" target="_blank" rel="noopener noreferrer">Format Codes</a></span>
            <% else %>
              <%= form.text_field field, placeholder: "Column Name or Index (e.g., 0)" %>
            <% end %>
          </div>
        <% end %>

        <div class="pure-controls">
          <%= form.submit class: "pure-button pure-button-primary" %>
          <%= link_to 'Cancel', import_columns_definitions_path, class: "pure-button" %>
        </div>
      </fieldset>
    <% end %>
  </div> <%# End Main Form Column %>


  <%# CSV Analyzer Form - Takes up the remaining width %>
  <div class="pure-u-1 pure-u-md-1-3">
    <div class="csv-analyzer-container"
         data-controller="csv-analyzer"
         data-csv-analyzer-url-value="<%= analyze_csv_import_columns_definitions_path %>"> <%# Pass URL to controller %>

      <form class="pure-form" data-action="submit->csv-analyzer#analyze">
        <fieldset>
          <legend>Analyze Sample CSV</legend>
          <p>Upload a sample CSV to see its columns/headers here.</p>

          <div class="pure-control-group">
            <%= label_tag :csv_file_analyzer, "Sample CSV File" %>
            <%= file_field_tag :csv_file,
                               accept: ".csv",
                               class: "pure-input-1",
                               data: { csv_analyzer_target: "fileInput" } %>
          </div>

          <div class="pure-controls">
            <button type="submit" class="pure-button pure-button-secondary" data-csv-analyzer-target="analyzeButton">
              Analyze File
            </button>
          </div>
        </fieldset>
      </form>

      <div class="analyzer-output" data-csv-analyzer-target="output" style="margin-top: 1em; padding: 0.5em; border: 1px solid #eee; min-height: 50px; background-color: #f9f9f9;">
        <%# Results will be displayed here by Stimulus %>
        <p class="pure-form-message-inline">Analysis results will appear here.</p>
      </div>
    </div> <%# End Stimulus Controller div %>
  </div> <%# End Analyzer Column %>
</div> <%# End PureCSS Grid %>


<%# Add some basic styling if needed %>
<style>
    .credit-sign-container label.pure-radio {
        margin-right: 1em;
        display: inline-block;
    }
    .credit-sign-container input[type="radio"] {
        margin-right: 0.3em;
    }
    .csv-analyzer-container {
        padding-left: 2em; /* Add some spacing between forms on larger screens */
    }
    .analyzer-output ul.pure-list li {
        word-break: break-all; /* Prevent long headers/values from breaking layout */
    }
    /* Adjust layout for smaller screens if PureCSS grid doesn't handle it well enough */
    @media (max-width: 767px) {
        .csv-analyzer-container {
            padding-left: 0;
            margin-top: 2em;
        }
    }
</style>